<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>第 3 頁 | azer3D</title>
  <meta name="author" content="lenxyang@gmail.com">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="azer3D"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="azer3D" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">azer3D</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-01-29T02:34:00.000Z"><a href="/2016/01/29/azer/month-report-201602/">2016-01-29</a></time>
      
      
  
    <h1 class="title"><a href="/2016/01/29/azer/month-report-201602/">2016-02 Month Report</a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="201602__u6708_u5DE5_u4F5C"><a href="#201602__u6708_u5DE5_u4F5C" class="headerlink" title="201602 月工作"></a>201602 月工作</h1><h2 id="201602"><a href="#201602" class="headerlink" title="201602"></a>201602</h2><p>当前的目标是尽量熟悉所有的基础 Effect，并将所有的 Effect 融入到一个统一的可配置且高效的框架之内，目前框架已经基本成型，不过 Effect 还有很多不熟悉。</p>
<p>本月的时间较少，主要安排仍然是熟悉基础 Effect，目标是 3 月份开始整个系统的工作。此外 探索通用光照系统：所有计算光照的 HLSL 应该接口统一。</p>
<p>本月的时间不多，年前一周，年后两周，且能够工作的时间不多。</p>
<ul>
<li>Framework<ul>
<li><strong> p1 </strong>: Resource 加载增加 Buffer 机制</li>
<li><strong> p1 </strong>: D3D Vertex Layout Buffer(Donnot create differet object for same layout in DirectX11)</li>
<li><strong> p2 </strong>: Multiple Constants Buffer support in HLSL</li>
<li><strong> p2 </strong>: Instancing Rendering Support in framework</li>
</ul>
</li>
<li>Scene Management<ul>
<li><strong> p0 </strong>: Frustrum Culling</li>
<li><strong> p1 </strong>: BSP Scene Node</li>
</ul>
</li>
<li>Render Framework<ul>
<li><strong> p0 </strong>: Make all light use same interface with HLSL and c++  <strong> (completed) </strong></li>
<li><strong> p1 </strong>: Scene Render Framework With Stencil Reflection support</li>
<li><strong> p1 </strong>: Deferred Shadering</li>
<li><strong> p2 </strong>: Multithread Rendering</li>
</ul>
</li>
<li>Simple Effects<ul>
<li>Common<ul>
<li><strong> p0 </strong>: instanceing  <strong> (completed) </strong></li>
<li><strong> p0 </strong>: vertex_buffer based instanceing <strong> (completed) </strong></li>
<li><strong> p2 </strong>: montion blur</li>
<li><strong> p2 </strong>: Alpha to converage</li>
</ul>
</li>
<li>Stencil based techniques<ul>
<li><strong> p0 </strong>: Reflection <strong> (completed) </strong></li>
<li><strong> p1 </strong>: Shadow Volumn</li>
</ul>
</li>
<li>Compute Shader<ul>
<li><strong> p1 </strong>: FFT Transform</li>
</ul>
</li>
<li>Shadow Map (Need Universe Light Support)<ul>
<li><strong> p2 </strong>: PCF shadow <strong> (completed) </strong></li>
<li><strong> p2 </strong>: Multiple-light support</li>
<li><strong> p2 </strong>: Directional Light Support</li>
</ul>
</li>
<li>Tessellation<ul>
<li><strong> p0 </strong>: tessellation based terrain <strong> (completed) </strong></li>
<li><strong> p0 </strong>: decay</li>
</ul>
</li>
<li>Environment Mapping *<ul>
<li><strong> p0 </strong>: Cubemap based environement mapping <strong> (completed) </strong></li>
<li><strong> p1 </strong>: Geometry Shader based Cubemap mapping</li>
<li><strong> p1 </strong>: Multi-thread Cubemapping generation</li>
</ul>
</li>
<li><strong> p0 </strong>: Stream Particle <strong> (completed) </strong></li>
<li><strong> p0 </strong>: HDR</li>
<li><strong> p0 </strong>: SSAO</li>
<li><strong> p1 </strong>: Animation</li>
<li><strong> p1 </strong>: Water</li>
</ul>
</li>
<li>Terrain System<ul>
<li><strong> p1 </strong>: Tree-based Culling</li>
<li><strong> p1 </strong>: clipping</li>
</ul>
</li>
<li>UI<ul>
<li><strong> p1 </strong>: Multiple Effect Level</li>
<li><strong> p1 </strong>: Assets Window and Views</li>
<li><strong> p2 </strong>: Snapshot View of all resources</li>
<li><strong> p2 </strong>: Direct3D Parameters and Capability</li>
<li><strong> p2 </strong>: Add Footbar For Pane</li>
<li><strong> p2 </strong>: Float Textfield Controller</li>
<li><strong> p2 </strong>: Material Property UI </li>
<li><strong> p2 </strong>: Mesh Property UI</li>
<li><strong> p2 </strong>: Load UI config from file</li>
</ul>
</li>
<li>Unittest<ul>
<li><strong> p2 </strong>: Add unittest to azer</li>
</ul>
</li>
<li>Game Resources<ul>
<li>WOW Model data(Skinned mesh)</li>
<li>Wow Map data</li>
</ul>
</li>
<li>Books &amp; Papers<ul>
<li>Book: Real-Time Readering</li>
<li>Book: Advanced Lighting and Materials With Shaders</li>
<li><a href="http://colour-science.org/posts/the-importance-of-terminology-and-srgb-uncertainty/" target="_blank" rel="external">The Importance of Terminology and sRGB Uncertainty</a></li>
</ul>
</li>
</ul>
<h2 id="Bug"><a href="#Bug" class="headerlink" title="Bug"></a>Bug</h2><ul>
<li><strong> p0 </strong>: Image cannot Load data with mipmap</li>
</ul>
<h2 id="Daily_Report"><a href="#Daily_Report" class="headerlink" title="Daily Report"></a>Daily Report</h2><h3 id="20160201"><a href="#20160201" class="headerlink" title="20160201"></a>20160201</h3><ul>
<li>Stencil based Reflection</li>
</ul>
<h3 id="20160202"><a href="#20160202" class="headerlink" title="20160202"></a>20160202</h3><ul>
<li>Terrain Tessellation: Grid</li>
<li>Terrain Tessellation: Heightmap</li>
<li>Terrain Tessellation: Normal</li>
<li>Terrain Tessellation: Normal Render</li>
</ul>
<h3 id="20160203"><a href="#20160203" class="headerlink" title="20160203"></a>20160203</h3><ul>
<li>Fixbug: Tessellation Hull Constants Shader</li>
<li>Load Texture 2D Array </li>
<li>Terrain Tessellation: Texture</li>
<li>Stream Partice ?</li>
</ul>
<h3 id="20160215"><a href="#20160215" class="headerlink" title="20160215"></a>20160215</h3><ul>
<li>Refactor Code: GpuProgram -&gt; Shader</li>
<li>Refactor Code: Remote class VertexShader </li>
<li>Remove Uncessary Code</li>
</ul>
<h3 id="20160216"><a href="#20160216" class="headerlink" title="20160216"></a>20160216</h3><ul>
<li>Particle completed</li>
</ul>
<h3 id="20160217"><a href="#20160217" class="headerlink" title="20160217"></a>20160217</h3><ul>
<li>PerInstance VertexBuffer Support</li>
<li>Instancing Rendering</li>
<li>Cubemap</li>
</ul>
<h3 id="20160218"><a href="#20160218" class="headerlink" title="20160218"></a>20160218</h3><ul>
<li>universeal light<ul>
<li>由于统一 light 的接口对于后续工作有非常重要的影响，较多任务依赖于他，因此决定现在开始</li>
</ul>
</li>
<li>migrate samples</li>
</ul>
<h3 id="20160219"><a href="#20160219" class="headerlink" title="20160219"></a>20160219</h3><ul>
<li>将 scene 和 resource 移到 azer 当中</li>
<li>loardaeron 的按照新的 light 框架更新</li>
<li>更新 samples</li>
</ul>
<h3 id="20160220"><a href="#20160220" class="headerlink" title="20160220"></a>20160220</h3><ul>
<li>建立 shaderlib 并用 grit 保存</li>
<li>迁移 scene 的 samples</li>
</ul>
<h3 id="20160222"><a href="#20160222" class="headerlink" title="20160222"></a>20160222</h3><ul>
<li>dds 文件格式解析</li>
</ul>
<h3 id="doing"><a href="#doing" class="headerlink" title="doing"></a><strong> doing </strong></h3><ul>
<li>HDR ?</li>
<li>SSAO ?</li>
<li>SSR ?</li>
<li>Picking ?</li>
<li>Decay ?</li>
<li>加载 dds<ul>
<li>之前发现问题，带有 mipmap 的 dds 图片加载有问题（这可能也是加载 wow 地形数据出问题的原因）</li>
<li>另外 soli 加载 DDS 文件实在太慢，因此决定自己实现一套加载图片的库</li>
<li>支持 dds, bmp, tga</li>
</ul>
</li>
<li>shader binary resource</li>
</ul>
<h3 id="Refactor"><a href="#Refactor" class="headerlink" title="Refactor"></a><strong> Refactor </strong></h3><ul>
<li>Renderer -&gt; RenderContext</li>
<li>RenderSystem -&gt; RenderDevice</li>
</ul>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-01-28T07:52:22.538Z"><a href="/2016/01/28/d3d11/monblur10/">2016-01-28</a></time>
      
      
  
    <h1 class="title"><a href="/2016/01/28/d3d11/monblur10/">2016-01 Direct3D10 Samples - Monblur</a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="Monblur10"><a href="#Monblur10" class="headerlink" title="Monblur10"></a>Monblur10</h1><h2 id="Problems"><a href="#Problems" class="headerlink" title="Problems"></a>Problems</h2><p>从 hlsl 的代码看， gs 的输出是每次对三角形的一边处理多次，而后生成 triangle。通过一条边生成的 triangle 有意义吗？ 莫非是一次通过对一条边的变换生成三角形？</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">define</span> MAX_TIME_STEPS <span class="number">3</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ExtrudeEdge</span><span class="params">( VSMotionBlurOut v1, </span><br><span class="line">                  VSMotionBlurOut v2, </span><br><span class="line">                  uniform uint iStep,</span><br><span class="line">                  inout TriangleStream&lt;GSMotionBlurOut&gt; SceneTriangleStream )</span> </span>&#123;</span><br><span class="line">    GSMotionBlurOut oV1;</span><br><span class="line">    GSMotionBlurOut oV2;</span><br><span class="line">    ....</span><br><span class="line">    SceneTriangleStream.Append( oV2 );</span><br><span class="line">    SceneTriangleStream.Append( oV1 );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ExtrudeBlurEdges</span><span class="params">( VSMotionBlurOut v1,</span><br><span class="line">                      VSMotionBlurOut v2,</span><br><span class="line">                      inout TriangleStream&lt;GSMotionBlurOut&gt; SceneTriangleStream,</span><br><span class="line">                      uniform <span class="keyword">bool</span> FrontSide )</span> </span>&#123;           </span><br><span class="line">    uint iStart = <span class="number">0</span>;</span><br><span class="line">    uint iEnd = MAX_TIME_STEPS;</span><br><span class="line">    </span><br><span class="line">    [unroll] <span class="keyword">for</span>(uint i=iStart; i&lt;iEnd; i++)</span><br><span class="line">    &#123;       </span><br><span class="line">        ExtrudeEdge( v1, v2, i, SceneTriangleStream );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    SceneTriangleStream.RestartStrip();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[maxvertexcount(<span class="number">30</span>)]</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">GSMotionBlurMain</span><span class="params">( triangle VSMotionBlurOut In[<span class="number">3</span>], </span><br><span class="line">                       inout TriangleStream&lt;GSMotionBlurOut&gt; SceneTriangleStream, </span><br><span class="line">                       uniform <span class="keyword">bool</span> bFrontSide )</span> </span>&#123;</span><br><span class="line">  ExtrudeBlurEdges( In[<span class="number">0</span>], In[<span class="number">1</span>], SceneTriangleStream, bFrontSide );</span><br><span class="line">  ExtrudeBlurEdges( In[<span class="number">1</span>], In[<span class="number">2</span>], SceneTriangleStream, bFrontSide );</span><br><span class="line">  ExtrudeBlurEdges( In[<span class="number">2</span>], In[<span class="number">0</span>], SceneTriangleStream, bFrontSide );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Alpha_to_Converage"><a href="#Alpha_to_Converage" class="headerlink" title="Alpha to Converage"></a>Alpha to Converage</h2>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-01-27T07:49:00.000Z"><a href="/2016/01/27/d3d11/detailmap/">2016-01-27</a></time>
      
      
  
    <h1 class="title"><a href="/2016/01/27/d3d11/detailmap/">Direct3D11 Detailmap</a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="Detailmap"><a href="#Detailmap" class="headerlink" title="Detailmap"></a>Detailmap</h1><h2 id="Tessellation_based_method"><a href="#Tessellation_based_method" class="headerlink" title="Tessellation based method"></a>Tessellation based method</h2><p>Detailmap(Tessellation based) 能够在渲染管线级别上决定几何体的细节，比起 normalmap 和 parallex mapping 要真是的多。(normalmap 无法处理遮挡关系，如果细节起伏较大会失真; parallex mapping 一定程度上解决了遮挡关系的问题，但如果某个高度变化到不可见状态时，parallex mapping 是没办法处理的)</p>
<p>Tessellation based method 还有诸多优点</p>
<h2 id="u5B9E_u73B0_u7EC6_u8282"><a href="#u5B9E_u73B0_u7EC6_u8282" class="headerlink" title="实现细节"></a>实现细节</h2><h3 id="Density_Map"><a href="#Density_Map" class="headerlink" title="Density Map"></a>Density Map</h3><p>Tessellation 的分割参数 (Hull Constants Shader) 与很多因素相关，具体可以分成动态及静态两种；具体来说，与摄像头的距离是动态的，与摄像头的方向夹角这些因素是动态的；此外，Mesh 对象本身的特征是静态的，高度变化较为剧烈的地方应该采用较密集的分割，变化平缓的地方采用较少的分割。高度图是静态的，所以可以采用离线或者加载时刻生成的办法生成一张分割参数的 Texture，用来帮助 Tessellation 的 Hull Constants Shader 的性能</p>
<p>具体可以参考 CreateDensityMapFromHeightMap</p>
<h2 id="DevNotes"><a href="#DevNotes" class="headerlink" title="DevNotes"></a>DevNotes</h2><h1 id="u53C2_u8003"><a href="#u53C2_u8003" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="http://http.developer.nvidia.com/GPUGems2/gpugems2_chapter07.html" target="_blank" rel="external">GPU Gems 2: Chapter 7. Adaptive Tessellation of Subdivision Surfaces with Displacement Mapping</a></li>
<li>Direct3D Rendering CookBook: Chapter 6 Adding Surface Detail with Normal and Displacement Mapping</li>
</ul>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-01-26T07:12:55.000Z"><a href="/2016/01/26/depot_tools/myrepo/">2016-01-26</a></time>
      
      
  
    <h1 class="title"><a href="/2016/01/26/depot_tools/myrepo/">myrepo</a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="My_Repo"><a href="#My_Repo" class="headerlink" title="My Repo"></a>My Repo</h1><h2 id="u8BBE_u8BA1_u76EE_u6807"><a href="#u8BBE_u8BA1_u76EE_u6807" class="headerlink" title="设计目标"></a>设计目标</h2><ul>
<li>同步多个 svn 目录</li>
<li>根据用户权限创建软链接或者直接使用代码</li>
<li>根据用户设置 checkout 库 (URL 或者配置文件)</li>
<li>提交编译机发布库</li>
</ul>
<h2 id="u4F7F_u7528_u573A_u666F"><a href="#u4F7F_u7528_u573A_u666F" class="headerlink" title="使用场景"></a>使用场景</h2><h3 id="checkout__u4EE3_u7801_u5E93"><a href="#checkout__u4EE3_u7801_u5E93" class="headerlink" title="checkout 代码库"></a>checkout 代码库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repo co --pub_dir=/home/yanglei/pub wolong base rpc</span><br></pre></td></tr></table></figure>
<h3 id="u540C_u6B65_u4EE3_u7801_u5E93"><a href="#u540C_u6B65_u4EE3_u7801_u5E93" class="headerlink" title="同步代码库"></a>同步代码库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repo sync --ignore_path pub</span><br></pre></td></tr></table></figure>
<h3 id="public"><a href="#public" class="headerlink" title="public"></a>public</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repo pub wolong/auditing/base/BUILD.gn@version ...</span><br></pre></td></tr></table></figure>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul>
<li><a href="https://source.android.com/source/using-repo.html" target="_blank" rel="external">Android: Repo command reference</a></li>
<li><a href="https://android.googlesource.com/tools/repo/+/745b4ad660f8050045b521c4e15b7d3ac0b3d70e/repo" target="_blank" rel="external">Repo code</a></li>
</ul>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-01-26T07:12:55.000Z"><a href="/2016/01/26/depot_tools/svn-access-control/">2016-01-26</a></time>
      
      
  
    <h1 class="title"><a href="/2016/01/26/depot_tools/svn-access-control/">svn-access-control</a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="Svn_Access_Control"><a href="#Svn_Access_Control" class="headerlink" title="Svn Access Control"></a>Svn Access Control</h1><h2 id="u76EE_u5F55_u7EA7_u6743_u9650_u7BA1_u7406"><a href="#u76EE_u5F55_u7EA7_u6743_u9650_u7BA1_u7406" class="headerlink" title="目录级权限管理"></a>目录级权限管理</h2><p>修改文件 /etc/httpd/conf/httpd.conf， 增加配置项 AuthzSVNAccessFile<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;VirtualHost <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">443</span>&gt;</span><br><span class="line">  SSLEngine on</span><br><span class="line">  SSLCertificateFile      /etc/httpd/ssl/server.csr</span><br><span class="line">  SSLCertificateKeyFile   /etc/httpd/ssl/server.key</span><br><span class="line"></span><br><span class="line">  &lt;Location /svn&gt;</span><br><span class="line">     DAV svn</span><br><span class="line">     SVNParentPath /home/svn/repo</span><br><span class="line">     AuthName <span class="string">"SVN Repositories"</span></span><br><span class="line">     AuthType Basic</span><br><span class="line">     AuthUserFile /home/svn/repo/.htpasswd</span><br><span class="line">     AuthzSVNAccessFile /home/svn/repo/.authz</span><br><span class="line">     Require valid-user</span><br><span class="line">  &lt;/Location&gt;</span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="AuthzSVNAccessFile__u6587_u4EF6_u5185_u5BB9"><a href="#AuthzSVNAccessFile__u6587_u4EF6_u5185_u5BB9" class="headerlink" title="AuthzSVNAccessFile 文件内容"></a>AuthzSVNAccessFile 文件内容</h3><p>AuthzSVNAccessFile 的内容看起来是这样</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[svn:/]</span><br><span class="line">* = r</span><br><span class="line">admin = rw</span><br><span class="line">yanglei = rw</span><br></pre></td></tr></table></figure>
<h2 id="u901A_u8FC7_repo__u6587_u4EF6_u7BA1_u7406_u6743_u9650"><a href="#u901A_u8FC7_repo__u6587_u4EF6_u7BA1_u7406_u6743_u9650" class="headerlink" title="通过 repo 文件管理权限"></a>通过 repo 文件管理权限</h2><p>默认情况下 SVN 使用 DAS 方式管理权限直接配置在服务器端，不过这样做的坏处时权限管理必须访问 SVN 服务器才能够完成。</p>
<p>较为方便的方法是在 Repositiory 当中增加特殊文件表达权限管理，在 checkin 的时候（通过 svn 的 hook 机制）自动生成 DAS 权限管理文件</p>
<h2 id="Trouble_Shooting"><a href="#Trouble_Shooting" class="headerlink" title="Trouble Shooting"></a>Trouble Shooting</h2><h3 id="Commit_blocked_by_pre-commit__28exit_code_255_29_with_no_output"><a href="#Commit_blocked_by_pre-commit__28exit_code_255_29_with_no_output" class="headerlink" title="Commit blocked by pre-commit (exit code 255) with no output"></a>Commit blocked by pre-commit (exit code 255) with no output</h3><p>可能的原因包括</p>
<ul>
<li>pre-commit 没有可执行权限</li>
<li>pre-commit 有语法错误</li>
</ul>
<h3 id="svn_3A_E175013_3A_Access_to__u2018https_3A//100-85-23-45/svn/test1_u2018_forbidden"><a href="#svn_3A_E175013_3A_Access_to__u2018https_3A//100-85-23-45/svn/test1_u2018_forbidden" class="headerlink" title="svn: E175013: Access to ‘https://100.85.23.45/svn/test1‘ forbidden"></a>svn: E175013: Access to ‘<a href="https://100.85.23.45/svn/test1" target="_blank" rel="external">https://100.85.23.45/svn/test1</a>‘ forbidden</h3><p>有可能 AuthzSVNAccessFile 的路径配置错误了， 查看 /var/log/httpd 的日志确定错误</p>
<h2 id="u53C2_u8003"><a href="#u53C2_u8003" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="http://svnbook.red-bean.com/en/1.7/index.html" target="_blank" rel="external">Version Control with Subversion(1.7)</a></li>
</ul>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-01-26T07:12:55.000Z"><a href="/2016/01/26/depot_tools/svn-setup/">2016-01-26</a></time>
      
      
  
    <h1 class="title"><a href="/2016/01/26/depot_tools/svn-setup/">svn-setup</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="u67B6_u8BBE_svn__u670D_u52A1_u5668"><a href="#u67B6_u8BBE_svn__u670D_u52A1_u5668" class="headerlink" title="架设 svn 服务器"></a>架设 svn 服务器</h2><h3 id="u521B_u5EFA_svn__u8DEF_u5F84"><a href="#u521B_u5EFA_svn__u8DEF_u5F84" class="headerlink" title="创建 svn 路径"></a>创建 svn 路径</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo adduser svn ...</span><br><span class="line">$ mkdir <span class="regexp">/home/</span>svn<span class="regexp">/repo/</span></span><br><span class="line">$ svnadmin create <span class="regexp">/home/</span>svn<span class="regexp">/repo/</span>test</span><br></pre></td></tr></table></figure>
<h3 id="u67B6_u8BBE_http_28https_29__u670D_u52A1_u5668"><a href="#u67B6_u8BBE_http_28https_29__u670D_u52A1_u5668" class="headerlink" title="架设 http(https) 服务器"></a>架设 http(https) 服务器</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># &#23433;&#35013; apache svn &#27169;&#22359;&#10;apt-get install apache2 libapache2-mod-svn&#10;&#10;# &#36890;&#36807; htpasswd &#29983;&#25104;&#23494;&#30721;&#10;apt-get install apache2-utils</span><br></pre></td></tr></table></figure>
<h3 id="u914D_u7F6E_http__u52A0_u8F7D_u9879_u53CA_u8DEF_u5F84"><a href="#u914D_u7F6E_http__u52A0_u8F7D_u9879_u53CA_u8DEF_u5F84" class="headerlink" title="配置 http 加载项及路径"></a>配置 http 加载项及路径</h3><h4 id="u914D_u7F6E_HTTP__u52A0_u8F7D_u9879"><a href="#u914D_u7F6E_HTTP__u52A0_u8F7D_u9879" class="headerlink" title="配置 HTTP 加载项"></a>配置 HTTP 加载项</h4><p>在 /etc/apache2/apache2.conf</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LoadModule dav_module           modules/mod_dav.so</span><br><span class="line">#LoadModule dav_fs_module       modules/mod_dav_fs.so</span><br><span class="line">LoadModule dav_svn_module       modules/mod_dav_svn.so</span><br><span class="line">LoadModule authz_svn_module     modules/mod_authz_svn.so</span><br></pre></td></tr></table></figure>
<h4 id="u5728_/etc/apache2/sites-available/000-default-conf__u5F53_u4E2D_u589E_u52A0_u4E00_u4E0B_u914D_u7F6E"><a href="#u5728_/etc/apache2/sites-available/000-default-conf__u5F53_u4E2D_u589E_u52A0_u4E00_u4E0B_u914D_u7F6E" class="headerlink" title="在  /etc/apache2/sites-available/000-default.conf 当中增加一下配置"></a>在  /etc/apache2/sites-available/000-default.conf 当中增加一下配置</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">Location</span> /<span class="attribute">svn</span>&gt;</span></span><br><span class="line">   DAV svn</span><br><span class="line">   SVNParentPath /home/svn/repo</span><br><span class="line">   AuthName "svn"</span><br><span class="line">   AuthType Basic</span><br><span class="line">   AuthUserFile /home/svn/repo/.svn-auth-file</span><br><span class="line">   Require valid-user</span><br><span class="line"><span class="tag">&lt;/<span class="title">Location</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="u521B_u5EFA_u53EF_u4EE5_u53EF_u4EE5_u8D26_u6237_u7528_u4E8E_u8BBF_u95EE_svn__u5E76_u91CD_u65B0_u542F_u52A8_httpd"><a href="#u521B_u5EFA_u53EF_u4EE5_u53EF_u4EE5_u8D26_u6237_u7528_u4E8E_u8BBF_u95EE_svn__u5E76_u91CD_u65B0_u542F_u52A8_httpd" class="headerlink" title="创建可以可以账户用于访问 svn 并重新启动 httpd"></a>创建可以可以账户用于访问 svn 并重新启动 httpd</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo htpasswd -cs /home/svn/repo/.svn-auth-file yanglei</span><br><span class="line">$ sudo /etc/init.d/apache2 restart</span><br></pre></td></tr></table></figure>
<p>此时通过 http 已经可以访问 svn 了，直接用浏览器打开</p>
<h4 id="u4F7F_u7528_svn__u5BA2_u6237_u7AEF_u6D4B_u8BD5"><a href="#u4F7F_u7528_svn__u5BA2_u6237_u7AEF_u6D4B_u8BD5" class="headerlink" title="使用 svn 客户端测试"></a>使用 svn 客户端测试</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn co http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8000</span>/svn/<span class="built_in">test</span></span><br></pre></td></tr></table></figure>
<h3 id="u901A_u8FC7_https__u8BBF_u95EE"><a href="#u901A_u8FC7_https__u8BBF_u95EE" class="headerlink" title="通过 https 访问"></a>通过 https 访问</h3><h4 id="u52A0_u8F7D_ssl_mod"><a href="#u52A0_u8F7D_ssl_mod" class="headerlink" title="加载 ssl_mod"></a>加载 ssl_mod</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在 /etc/apache2/apache2.conf 增加</span></span><br><span class="line">Include /etc/apache2/mods-available/ssl.conf</span><br><span class="line">LoadModule ssl_module /usr/lib/apache2/modules/mod_ssl.so</span><br></pre></td></tr></table></figure>
<h4 id="u6253_u5F00_u7AEF_u53E3"><a href="#u6253_u5F00_u7AEF_u53E3" class="headerlink" title="打开端口"></a>打开端口</h4><p>默认情况下，ssl 端口是不打开的，直接修改 /etc/apache2/ports.conf 的配置打开端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Listen <span class="number">80</span></span><br><span class="line">&lt;IfModule ssl_module&gt;</span><br><span class="line">        Listen <span class="number">443</span></span><br><span class="line">&lt;/IfModule&gt;</span><br></pre></td></tr></table></figure>
<h4 id="u542F_u7528_u7AD9_u70B9"><a href="#u542F_u7528_u7AD9_u70B9" class="headerlink" title="启用站点"></a>启用站点</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo a2ensite default-ssl.conf</span><br></pre></td></tr></table></figure>
<h4 id="u751F_u6210_u81EA_u5DF1_u7684_key"><a href="#u751F_u6210_u81EA_u5DF1_u7684_key" class="headerlink" title="生成自己的 key"></a>生成自己的 key</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mkdir /etc/apache2/ssl</span><br><span class="line">$ sudo openssl req -new -x509 -keyout /etc/apache2/ssl/server.key -out /etc/apache2/ssl/server.csr -days <span class="number">365</span> -nodes</span><br><span class="line">Country Name (<span class="number">2</span> letter code) [AU]:</span><br><span class="line">State or Province Name (full name) [Some-State]:</span><br><span class="line">Locality Name (eg, city) []:</span><br><span class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:</span><br><span class="line">Organizational Unit Name (eg, section) []:</span><br><span class="line">Common Name (eg, YOUR name) []:svn</span><br></pre></td></tr></table></figure>
<p><strong> 注意：</strong> Common Name 最好与站点名称一致否则会出错</p>
<h4 id="u542F_u52A8_key"><a href="#u542F_u52A8_key" class="headerlink" title="启动 key"></a>启动 key</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># file path: /etc/apache2/sites-available/ssl-default</span><br><span class="line">       #   SSL Engine Switch:</span><br><span class="line">       #   Enable/Disable SSL for this virtual host.</span><br><span class="line">       SSLEngine on</span><br><span class="line">       #   A self-signed (snakeoil) certificate can be created by installing</span><br><span class="line">       #   the ssl-cert package. See</span><br><span class="line">       #   /usr/share/doc/apache2/README.Debian.gz for more info.</span><br><span class="line">       #   If both key and certificate are stored in the same file, only the</span><br><span class="line">       #   SSLCertificateFile directive is needed.</span><br><span class="line">       SSLCertificateFile      /etc/apache2/ssl/server.csr</span><br><span class="line">       SSLCertificateKeyFile   /etc/apache2/ssl/server.key</span><br></pre></td></tr></table></figure>
<h3 id="u4EE5_svn__u8D26_u6237_u8FD0_u884C"><a href="#u4EE5_svn__u8D26_u6237_u8FD0_u884C" class="headerlink" title="以 svn 账户运行"></a>以 svn 账户运行</h3><h2 id="svn__u6743_u9650_u7BA1_u7406"><a href="#svn__u6743_u9650_u7BA1_u7406" class="headerlink" title="svn 权限管理"></a>svn 权限管理</h2><h2 id="u89E3_u51B3_u7684_u65B9_u6CD5"><a href="#u89E3_u51B3_u7684_u65B9_u6CD5" class="headerlink" title="解决的方法"></a>解决的方法</h2><h3 id="u68C0_u67E5_apache2__u65E5_u5FD7"><a href="#u68C0_u67E5_apache2__u65E5_u5FD7" class="headerlink" title="检查 apache2 日志"></a>检查 apache2 日志</h3><p>如果遇到什么问题，先查看 apache2 的日志，常见的问题答案就在里面。如果希望得到更详细的信息，可以在 /etc/apache2/apache2.conf 当中修改日志级别</p>
<h3 id="u68C0_u67E5_u7AEF_u53E3_u662F_u5426_u6253_u5F00"><a href="#u68C0_u67E5_u7AEF_u53E3_u662F_u5426_u6253_u5F00" class="headerlink" title="检查端口是否打开"></a>检查端口是否打开</h3><p>在配置 https 服务时，想要确定服务是否已经打开，最简单的办法是通过 netstat 命令查看 443 端口是否打开</p>
<h2 id="Trouble_Shooting"><a href="#Trouble_Shooting" class="headerlink" title="Trouble Shooting"></a>Trouble Shooting</h2><h3 id="apache__u7AD9_u70B9_u4E0D_u751F_u6548"><a href="#apache__u7AD9_u70B9_u4E0D_u751F_u6548" class="headerlink" title="apache 站点不生效"></a>apache 站点不生效</h3><p>/etc/apache2/sites-available 的意思是 “可用的网站”，并非 ”生效的网站“。通过 a2ensite 和 a2dissite 启用或停止网站。</p>
<h3 id="AH00566_3A_request_failed_3A_invalid_characters_in_URI"><a href="#AH00566_3A_request_failed_3A_invalid_characters_in_URI" class="headerlink" title="AH00566: request failed: invalid characters in URI"></a>AH00566: request failed: invalid characters in URI</h3><p>通过 https 访问时报错且 apache2 日志出现 “invalid characters in URI“。最后发现，site-available/default-ssl 所有配置，包含在 <ifmodule ssl_module=""> 当中，实际上并未启动。将 <ifmodule ssl_module=""> 注释掉之后，可以正常的通过 https 访问</ifmodule></ifmodule></p>
<h2 id="u5728_CentOS__u4E0A_u67B6_u8BBE"><a href="#u5728_CentOS__u4E0A_u67B6_u8BBE" class="headerlink" title="在 CentOS 上架设"></a>在 CentOS 上架设</h2><p>之前描述的 ubuntu 上的架设过程， CentOS 由于 apache 的配置目录有很大不同，所以配置也有差别, 接下来以 RHEL 7 为例介绍</p>
<h3 id="u5B89_u88C5_u8F6F_u4EF6"><a href="#u5B89_u88C5_u8F6F_u4EF6" class="headerlink" title="安装软件"></a>安装软件</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install httpd.x86_64 mod_dav_svn.x86_64 mod_ssl.x86_64</span><br></pre></td></tr></table></figure>
<h3 id="u4FEE_u6539_u914D_u7F6E_u6587_u4EF6"><a href="#u4FEE_u6539_u914D_u7F6E_u6587_u4EF6" class="headerlink" title="修改配置文件"></a>修改配置文件</h3><p>CentOS 上的配置与 Ubuntu 有极大不同，Ubuntu 细化了配置，用户需要配置站点级别，而 CentOS 仅仅有最简单的配置。</p>
<p>修改文件 /etc/httpd/conf/httpd.conf<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;VirtualHost <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">443</span>&gt;</span><br><span class="line">  SSLEngine on</span><br><span class="line">  SSLCertificateFile      /etc/httpd/ssl/server.csr</span><br><span class="line">  SSLCertificateKeyFile   /etc/httpd/ssl/server.key</span><br><span class="line"></span><br><span class="line">  &lt;Location /svn&gt;</span><br><span class="line">     DAV svn</span><br><span class="line">     SVNParentPath /home/svn/repo</span><br><span class="line">     AuthName <span class="string">"SVN Repositories"</span></span><br><span class="line">     AuthType Basic</span><br><span class="line">     AuthUserFile /home/svn/repo/.htpasswd</span><br><span class="line">     AuthzSVNAccessFile /home/svn/repo/.authz</span><br><span class="line">     Require valid-user</span><br><span class="line">  &lt;/Location&gt;</span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure></p>
<p>此外还要更改文件 /etc/httpd/conf.d/ssl.conf<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Listen 443 https</span></span><br><span class="line"><span class="comment"># Listen 0.0.0.0:443 https</span></span><br></pre></td></tr></table></figure></p>
<p>否则 httpd 仅仅监听 ip6 的端口， ipv4 端口不能访问</p>
<h3 id="u542F_u52A8_u670D_u52A1"><a href="#u542F_u52A8_u670D_u52A1" class="headerlink" title="启动服务"></a>启动服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service httpd restart</span><br></pre></td></tr></table></figure>
<h3 id="u67E5_u770B_u670D_u52A1_u72B6_u6001_u673A_u65E5_u5FD7"><a href="#u67E5_u770B_u670D_u52A1_u72B6_u6001_u673A_u65E5_u5FD7" class="headerlink" title="查看服务状态机日志"></a>查看服务状态机日志</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status httpd.service</span><br></pre></td></tr></table></figure>
<h2 id="Trouble_Shooting-1"><a href="#Trouble_Shooting-1" class="headerlink" title="Trouble Shooting"></a>Trouble Shooting</h2><h3 id="5B_3Aerror_5D__5Bpid_8974_5D__2820014_29Internal_error_3A_Can_u2019t_open_file__u2018/home/svn/repo/xxx/format_u2019_3A_Permission_denied"><a href="#5B_3Aerror_5D__5Bpid_8974_5D__2820014_29Internal_error_3A_Can_u2019t_open_file__u2018/home/svn/repo/xxx/format_u2019_3A_Permission_denied" class="headerlink" title="[:error] [pid 8974] (20014)Internal error: Can’t open file ‘/home/svn/repo/xxx/format’: Permission denied"></a>[:error] [pid 8974] (20014)Internal error: Can’t open file ‘/home/svn/repo/xxx/format’: Permission denied</h3><p>一般来说此错误是没有权限导致的，如果即使授予 777 或者更改 owner 仍然出现此错误的话，有可能是 selinux 导致的，通过命令 setenforce 0 关闭它再尝试。</p>
<p>如果想要永久关闭 selinux, 可以修改配置文件 /etc/selinux/config</p>
<h3 id="u5176_u4ED6_u673A_u5668_u65E0_u6CD5_u8BBF_u95EE_https"><a href="#u5176_u4ED6_u673A_u5668_u65E0_u6CD5_u8BBF_u95EE_https" class="headerlink" title="其他机器无法访问 https"></a>其他机器无法访问 https</h3><ul>
<li>有可能是 IP 设置为 127.0.0.1 造成的，改为 0.0.0.0</li>
<li>有可能是 iptables 造成的，直接关闭并清理<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">service iptables stop</span><br><span class="line">iptables -F</span><br><span class="line">iptables -X</span><br><span class="line">iptables -Z</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://wiki.archlinux.org/index.php/Subversion_Setup" target="_blank" rel="external">ArchLinux: Subversion Setup</a></li>
<li><a href="https://help.ubuntu.com/community/Subversion" target="_blank" rel="external">Ubuntu Wiki: Subversion</a></li>
<li><a href="http://www.apache-ssl.org/" target="_blank" rel="external">Apache-SSL</a></li>
<li><a href="http://www.onlamp.com/2008/03/04/step-by-step-configuring-ssl-under-apache.html" target="_blank" rel="external">Step-By-Step Configuring SSL Under Apache</a></li>
</ul>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-01-26T07:12:55.000Z"><a href="/2016/01/26/depot_tools/android_repo/">2016-01-26</a></time>
      
      
  
    <h1 class="title"><a href="/2016/01/26/depot_tools/android_repo/">android repo</a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="Android_Repo"><a href="#Android_Repo" class="headerlink" title="Android Repo"></a>Android Repo</h1><h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul>
<li><a href="https://source.android.com/source/using-repo.html" target="_blank" rel="external">Android: Repo command reference</a></li>
<li><a href="https://android.googlesource.com/tools/repo/+/745b4ad660f8050045b521c4e15b7d3ac0b3d70e/repo" target="_blank" rel="external">Repo code</a></li>
</ul>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-01-25T08:52:47.000Z"><a href="/2016/01/25/skia/skia-tricks/">2016-01-25</a></time>
      
      
  
    <h1 class="title"><a href="/2016/01/25/skia/skia-tricks/">Skia Tricks</a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="Skia_Ticks"><a href="#Skia_Ticks" class="headerlink" title="Skia Ticks"></a>Skia Ticks</h1><h2 id="Common"><a href="#Common" class="headerlink" title="Common"></a>Common</h2><h3 id="Save_SkBitmap_2C_gfx_3A_3AImageSkia"><a href="#Save_SkBitmap_2C_gfx_3A_3AImageSkia" class="headerlink" title="Save SkBitmap, gfx::ImageSkia"></a>Save SkBitmap, gfx::ImageSkia</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#!c++</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">"base/files/file_path.h"</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">"base/files/file_util.h"</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span> <span class="string">"ui/gfx/codec/png_codec.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">SaveImageSkia</span><span class="params">(<span class="keyword">const</span> gfx::ImageSkia* img, base::FilePath&amp; path)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;uint8&gt; vec;</span><br><span class="line">  gfx::PNGCodec::EncodeBGRASkBitmap(*img-&gt;bitmap(), <span class="literal">false</span>, &amp;vec);</span><br><span class="line">  <span class="keyword">return</span> base::WriteFile(path, (<span class="keyword">const</span> <span class="keyword">char</span>*)&amp;(vec[<span class="number">0</span>]), vec.size());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Trouble_Shooting"><a href="#Trouble_Shooting" class="headerlink" title="Trouble Shooting"></a>Trouble Shooting</h2><h3 id="views_3A_3AImageView__u4E0D_u80FD_u663E_u793A_SkBitmap"><a href="#views_3A_3AImageView__u4E0D_u80FD_u663E_u793A_SkBitmap" class="headerlink" title="views::ImageView 不能显示 SkBitmap"></a>views::ImageView 不能显示 SkBitmap</h3><p>在实现图片显示工具过程中，遇到了一个问题，通过SkBitmap创建的gfx::ImageSkia无法显示在::views::ImageView 控件上。</p>
<p>以下是创建SkBitmap的代码<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#!c++</span></span><br><span class="line">SkImageInfo info = SkImageInfo::Make(mipmap.width, mipmap.height,</span><br><span class="line">                                       kRGBA_8888_SkColorType,</span><br><span class="line">                                       kOpaque_SkAlphaType);</span><br><span class="line">SkBitmap* bitmap = <span class="keyword">new</span> SkBitmap;</span><br><span class="line">bitmap-&gt;setInfo(info);</span><br><span class="line">bitmap-&gt;allocPixels(info);</span><br><span class="line"><span class="comment">// 开始时，使用的是 bitmap-&gt;SetPiexl(mipmap.data);</span></span><br><span class="line"><span class="built_in">memcpy</span>(bitmap-&gt;getAddr32(<span class="number">0</span>, <span class="number">0</span>), mipmap.data, <span class="number">4</span> * mipmap.width * mipmap.height);</span><br><span class="line">gfx::ImageSkia image = gfx::ImageSkia::CreateFrom1xBitmap(*bitmap);</span><br></pre></td></tr></table></figure></p>
<p>views::ImageView始终无法显示图像，但采用 gfx::JPEGCodec::Decode 从文件当中读去的数据就可以显示<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#!c++</span></span><br><span class="line">scoped_ptr&lt;SkBitmap&gt; skbitmap(</span><br><span class="line">      gfx::JPEGCodec::Decode((<span class="keyword">unsigned</span> <span class="keyword">char</span>*)contents.c_str(), contents.length()));</span><br><span class="line">gfx::ImageSkia image = gfx::ImageSkia::CreateFrom1xBitmap(*skbitmap.get());</span><br></pre></td></tr></table></figure></p>
<p>最终按照gfx::JPEGCodec的方式创建SkBitmap问题解决，但还没有找到原因</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!c++</span></span><br><span class="line">  SkBitmap* bitmap = new SkBitmap<span class="comment">;</span></span><br><span class="line">  bitmap-&gt;allocN32Pixels<span class="list">(<span class="keyword">mipmap</span>.width, mipmap.height)</span><span class="comment">;</span></span><br><span class="line">  memcpy<span class="list">(<span class="keyword">bitmap-&gt;getAddr32</span><span class="list">(<span class="number">0</span>, <span class="number">0</span>)</span>, mipmap.data, <span class="number">4</span> <span class="variable">* mipmap.width *</span> mipmap.height)</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<h3 id="IDirect3D11Texture2D_u65E0_u6CD5_u8F6C_u6362_u4E3ASkBitmap"><a href="#IDirect3D11Texture2D_u65E0_u6CD5_u8F6C_u6362_u4E3ASkBitmap" class="headerlink" title="IDirect3D11Texture2D无法转换为SkBitmap"></a>IDirect3D11Texture2D无法转换为SkBitmap</h3><p>创建具有CPURead模式的Texture并将它读入SkBitmap，通过canvas-&gt;Draw 显示出来以后会发现他的 蓝色和红色是相反的，无论SkBitmap设置成什么模式都不行<br><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#!c++</span><br><span class="line">  info_ = SkImageInfo::MakeN32(<span class="built_in">size</span>.<span class="variable">width</span>(), <span class="built_in">size</span>.<span class="variable">height</span>(), kOpaque_SkAlphaType);</span><br><span class="line">  info_ = SkImageInfo::Make(<span class="built_in">size</span>.<span class="variable">width</span>(), <span class="built_in">size</span>.<span class="variable">height</span>(),</span><br><span class="line">                              kBGRA_8888_SkColorType, kOpaque_SkAlphaType);</span><br><span class="line">  info_ = SkImageInfo::Make(<span class="built_in">size</span>.<span class="variable">width</span>(), <span class="built_in">size</span>.<span class="variable">height</span>(),</span><br><span class="line">                              kRGBA_8888_SkColorType, kOpaque_SkAlphaType);</span><br><span class="line">  bitmap_.allocN32Pixels(<span class="built_in">size</span>.<span class="variable">width</span>(), <span class="built_in">size</span>.<span class="variable">height</span>());</span><br><span class="line">  bitmap_.allocPixels(info_);</span><br><span class="line"></span><br><span class="line">  TexturePtr tex = overlay_-&gt;GetTexture();</span><br><span class="line">  CHECK(tex-&gt;CopyTo(texture_.<span class="built_in">get</span>()));</span><br><span class="line">  Texture::MapData mapdata = texture_-&gt;<span class="built_in">map</span>(kReadOnly);</span><br><span class="line">  <span class="comment">// bitmap_.installPixels(info_, mapdata.pdata, mapdata.row_pitch);</span></span><br><span class="line">  memcpy(bitmap_.getPixels(), mapdata.pdata, <span class="number">256</span> * <span class="number">256</span> * <span class="number">4</span>);</span><br><span class="line">  texture_-&gt;unmap();</span><br><span class="line">  gfx::ImageSkia img = gfx::ImageSkia::CreateFrom1xBitmap(bitmap_);</span><br><span class="line">  canvas-&gt;DrawImageInt(img, <span class="number">0</span>, <span class="number">0</span>, <span class="number">256</span>, <span class="number">256</span>,</span><br><span class="line">                       <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">this</span>-&gt;<span class="variable">width</span>(), <span class="keyword">this</span>-&gt;<span class="variable">height</span>(), <span class="keyword">true</span>);</span><br></pre></td></tr></table></figure></p>
<p>但是用 KRGBA_8888 时，似乎连颜色都没有了，通过 shader 将 B 和 R 交换位置后输出，通过MakeN32模式就没有问题了。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-01-25T08:52:47.000Z"><a href="/2016/01/25/docker/fast-introduce-to-docker/">2016-01-25</a></time>
      
      
  
    <h1 class="title"><a href="/2016/01/25/docker/fast-introduce-to-docker/">fast-introduce-to-docker</a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="Docker__u5FEB_u901F_u4ECB_u7ECD"><a href="#Docker__u5FEB_u901F_u4ECB_u7ECD" class="headerlink" title="Docker 快速介绍"></a>Docker 快速介绍</h1><p>本文档主要目的是说明 docker 的最简单也是最核心的功能。</p>
<p>Docker 的最重要功能是系统镜像(包括系统内核、系统库、系统程序及数据)，例如服务端程序依赖于 NLP 模块、NLP 词典以及对应.so文件。 不过的服务程序可能不便，但这几个基本模块都需要。在这种情形下，我们可以按照当前内核基础上创建一个镜像，并在此镜像内部加入 NLP 的 so 及字典文件。</p>
<p>接下来我们将使用最简单的代码及依赖关系说明如何 Docker 进行快速部署。</p>
<h2 id="u955C_u50CF_u64CD_u4F5C"><a href="#u955C_u50CF_u64CD_u4F5C" class="headerlink" title="镜像操作"></a>镜像操作</h2><h3 id="u83B7_u5F97_u955C_u50CF"><a href="#u83B7_u5F97_u955C_u50CF" class="headerlink" title="获得镜像"></a>获得镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!bash</span></span><br><span class="line"><span class="comment"># 获得本地 images</span></span><br><span class="line">$ sudo docker images</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从 repository 获得 images</span></span><br><span class="line">$ sudo docker pull</span><br></pre></td></tr></table></figure>
<h3 id="docker_commit__u65B9_u5F0F_u521B_u5EFA_u955C_u50CF"><a href="#docker_commit__u65B9_u5F0F_u521B_u5EFA_u955C_u50CF" class="headerlink" title="docker commit 方式创建镜像"></a>docker commit 方式创建镜像</h3><h4 id="u4FEE_u6539_u955C_u50CF"><a href="#u4FEE_u6539_u955C_u50CF" class="headerlink" title="修改镜像"></a>修改镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!bash</span></span><br><span class="line"><span class="comment"># -t: allocate an tty, -i: interactive</span></span><br><span class="line">$ sudo docker run -i -t ubuntu /bin/bash</span><br><span class="line">$ apt-get install nginx</span><br></pre></td></tr></table></figure>
<h4 id="u67E5_u770B_u5F53_u524D_u6B63_u5728_u4F7F_u7528_u7684_u955C_u50CF"><a href="#u67E5_u770B_u5F53_u524D_u6B63_u5728_u4F7F_u7528_u7684_u955C_u50CF" class="headerlink" title="查看当前正在使用的镜像"></a>查看当前正在使用的镜像</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!bash</span></span><br><span class="line">[root@localhost yanglei]$ docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line"><span class="number">5</span>f969df0af99        ubuntu              <span class="string">"/bin/bash"</span>         <span class="number">4</span> minutes ago       Up <span class="number">4</span> minutes                            fervent_kirch</span><br></pre></td></tr></table></figure>
<h4 id="u4FDD_u5B58_u4FEE_u6539"><a href="#u4FDD_u5B58_u4FEE_u6539" class="headerlink" title="保存修改"></a>保存修改</h4><p>保存我们的修改，注意保存的 container 而非 image, container 可以从 docker 的 bin/bash 的命令行提是获得，也可以按照上面 docker ps 的方式获得<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!bash</span></span><br><span class="line">$ sudo docker commit -m <span class="string">"install nginx"</span> <span class="operator">-a</span> <span class="string">"lenxyang"</span> <span class="number">5</span>f969df0af99 ubuntu_with_nginx</span><br></pre></td></tr></table></figure></p>
<h3 id="Dockerfile__u5F62_u5F0F_u521B_u5EFA_u955C_u50CF"><a href="#Dockerfile__u5F62_u5F0F_u521B_u5EFA_u955C_u50CF" class="headerlink" title="Dockerfile 形式创建镜像"></a>Dockerfile 形式创建镜像</h3><p>创建一个目录并在目录下创建一个名为 Dockerfile 的文件，内容如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!bash</span></span><br><span class="line">FROM ubuntu:<span class="number">14.04</span></span><br><span class="line">MAINTAINER Docker Newbee &lt;newbee@docker.com&gt;</span><br><span class="line">$ apt-get install nginx</span><br></pre></td></tr></table></figure>
<p>而后运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!bash</span></span><br><span class="line"><span class="comment"># -t 表示 tag name</span></span><br><span class="line">$ sudo docker build -t=<span class="string">"ouruser/sinatra:v2"</span></span><br></pre></td></tr></table></figure>
<h3 id="u5220_u9664"><a href="#u5220_u9664" class="headerlink" title="删除"></a>删除</h3><p>删除命令有两个 rm 和 rmi， 其中 rm 的对象是 container, 而 rmi 的对象是 image.</p>
<h3 id="u4FDD_u5B58_u548C_u5BFC_u5165"><a href="#u4FDD_u5B58_u548C_u5BFC_u5165" class="headerlink" title="保存和导入"></a>保存和导入</h3><p>创建好的镜像可以通过 load 和 save 命令导入和保存<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!bash</span></span><br><span class="line">$ docker save -o file.tar imagename</span><br><span class="line">$ docker load --input file.tar</span><br><span class="line">$ docker load &lt; file.tar</span><br></pre></td></tr></table></figure></p>
<h2 id="u5BB9_u5668_28Container_29_u64CD_u4F5C"><a href="#u5BB9_u5668_28Container_29_u64CD_u4F5C" class="headerlink" title="容器(Container)操作"></a>容器(Container)操作</h2><p>Container 是 镜像运行起来之后的概念，其关系类似于 process 和 program。之前介绍容器是也提到了 Container 的操作(docker run -i -t ..)</p>
<h3 id="u542F_u52A8"><a href="#u542F_u52A8" class="headerlink" title="启动"></a>启动</h3><p>Container 基本是以程序的生命周期来进行的，如 docker -r -i … /bin/bash， 在 /bin/bash 退出时(如运行 exit 命令), 则整个 docker 都退出了。 Container 也可以以类似 (nohup ./run.sh &amp;) 的形式运行，及 daemon 形态。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!bash</span></span><br><span class="line">$ docker run <span class="operator">-d</span> imagename /bin/bash -C <span class="string">"while (true); do sleep(1); done"</span></span><br></pre></td></tr></table></figure></p>
<h3 id="u505C_u6B62"><a href="#u505C_u6B62" class="headerlink" title="停止"></a>停止</h3><p>通过 docker ps 查看正在运行的 container id, 而后通过<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bash</span></span><br><span class="line">$ sudo docker stop contain_id</span><br></pre></td></tr></table></figure></p>
<h3 id="Attach"><a href="#Attach" class="headerlink" title="Attach"></a>Attach</h3><p>docker 对进行除了提供  stop 之外，还提供了 start, restart。此时我们需要考虑如何登录到 container 上了，毕竟未没有 tty 啦。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!/bash</span></span><br><span class="line">$ sudo docker attach container_id</span><br></pre></td></tr></table></figure></p>
<p>attach 有一个问题，attach 之后，其他 attach 的用户就被挂起了, nsenter 可以解决这个问题。</p>
<h3 id="nsenter"><a href="#nsenter" class="headerlink" title="nsenter"></a>nsenter</h3><p>nsenter 可以访问指定进行的系统名字空间<br><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">$</span> <span class="comment">sudo</span> <span class="comment">nsenter</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">target</span> <span class="comment">10981</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">mount</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">uts</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">ipc</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">net</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">pid</span></span><br></pre></td></tr></table></figure></p>
<p>需要注意是 target 并不是 docker 的 container id, 而是 host machine 的 pid，命令 docker inspect 可以提供帮助<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="keyword">inspect</span> --<span class="keyword">format</span> <span class="string">"&#123;&#123; .State.Pid &#125;&#125;"</span> container_id</span><br></pre></td></tr></table></figure></p>
<h2 id="Data_Volumns"><a href="#Data_Volumns" class="headerlink" title="Data Volumns"></a>Data Volumns</h2><p>前面提到 nlp 的字典，这些字典通常非常巨大，如果每一个 image 保存一份，过于浪费数据了。还在 docker 有 Data Volumn，可以帮助多个 Container 共享内容。</p>
<h2 id="u7F51_u7EDC_u8BBF_u95EE"><a href="#u7F51_u7EDC_u8BBF_u95EE" class="headerlink" title="网络访问"></a>网络访问</h2><p>在 ubuntu 上安装 nginx 并启动后，从 docker 主机上可以通过 netstat 查看<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="shebang">#!bash</span></span><br><span class="line">root@<span class="number">83</span>d0ba715246:/$ netstat -nptl</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">80</span>              <span class="number">0.0</span>.<span class="number">0.0</span>:*               LISTEN      <span class="number">34</span>/nginx</span><br><span class="line">tcp6       <span class="number">0</span>      <span class="number">0</span> :::<span class="number">80</span>                   :::*                    LISTEN      <span class="number">34</span>/nginx</span><br></pre></td></tr></table></figure></p>
<p>但在 Host Machine 上却看不到</p>
<p>docker 提供命令在启动是进行端口映射<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># 绑定指定端口</span></span><br><span class="line">$ sudo docker run -d -p <span class="number">5000</span>:<span class="number">5000</span> ...</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># 绑定到本机 ip 地址</span></span><br><span class="line">$ sudo docker run -d -p <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">5000</span>:<span class="number">5000</span> ...</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># 绑定 udp 端口</span></span><br><span class="line">$ sudo docker run -d -p <span class="number">5000</span>:<span class="number">5000</span>/udp ...</span><br><span class="line"></span><br><span class="line"><span class="preprocessor"># 将本地任意一个端口绑定到 container <span class="number">5000</span> 上</span></span><br><span class="line">$ sudo docker run -d -p <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>::<span class="number">5000</span> ...</span><br></pre></td></tr></table></figure></p>
<h3 id="u67E5_u770B_u7AEF_u53E3_u6620_u5C04"><a href="#u67E5_u770B_u7AEF_u53E3_u6620_u5C04" class="headerlink" title="查看端口映射"></a>查看端口映射</h3><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="foreign"><span class="keyword">port</span> containerid</span></span><br></pre></td></tr></table></figure>
<h1 id="Trouble_Shooting"><a href="#Trouble_Shooting" class="headerlink" title="Trouble Shooting"></a>Trouble Shooting</h1><h2 id="Permission_denied_when_visit_Volumne_data"><a href="#Permission_denied_when_visit_Volumne_data" class="headerlink" title="Permission denied when visit Volumne data"></a>Permission denied when visit Volumne data</h2><p>尝试使用 flags –privileged=true</p>
<h1 id="u53C2_u8003"><a href="#u53C2_u8003" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a href="http://docs.docker.com/engine/userguide/dockerimages/" target="_blank" rel="external">Docker: Build your own images</a></li>
<li><a href="http://blog.scottlowe.org/2013/09/04/introducing-linux-network-namespaces/" target="_blank" rel="external">Scott’s Weblog: Introducing Linux Network Namespaces</a></li>
<li><a href="https://en.wikipedia.org/wiki/UnionFS" target="_blank" rel="external">Wiki: UnionFS</a></li>
<li><a href="http://dockerpool.com/static/books/docker_practice/index.html" target="_blank" rel="external">Docker</a></li>
</ul>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-01-25T08:52:47.000Z"><a href="/2016/01/25/d3d11/hlsl_devnotes/">2016-01-25</a></time>
      
      
  
    <h1 class="title"><a href="/2016/01/25/d3d11/hlsl_devnotes/">HLSL Devnotes</a></h1>
  

    </header>
    <div class="entry">
      
        <h1 id="HLSL_DevNotes"><a href="#HLSL_DevNotes" class="headerlink" title="HLSL DevNotes"></a>HLSL DevNotes</h1><h2 id="u5168_u5C40_u53D8_u91CF"><a href="#u5168_u5C40_u53D8_u91CF" class="headerlink" title="全局变量"></a>全局变量</h2><p>HLSL 的全局变量似乎与预期不一致, 以下代码所有的复制都无效，只能通过 #define 来定义常量</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">float</span> gMinDist = <span class="number">20.0f</span>;</span><br><span class="line"><span class="keyword">float</span> gMaxDist = <span class="number">50.0f</span>;</span><br><span class="line"><span class="keyword">float</span> gMinTess = <span class="number">0.0f</span>;</span><br><span class="line"><span class="keyword">float</span> gMaxTess = <span class="number">6.0f</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">float</span> gMinDist = <span class="number">20.0f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">float</span> gMaxDist = <span class="number">50.0f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">float</span> gMinTess = <span class="number">0.0f</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">float</span> gMaxTess = <span class="number">6.0f</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cbuffer buffer &#123;</span><br><span class="line"><span class="keyword">float</span> gMinDist = <span class="number">20.0f</span>;</span><br><span class="line"><span class="keyword">float</span> gMaxDist = <span class="number">50.0f</span>;</span><br><span class="line"><span class="keyword">float</span> gMinTess = <span class="number">0.0f</span>;</span><br><span class="line"><span class="keyword">float</span> gMaxTess = <span class="number">6.0f</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h2><h3 id="fcx"><a href="#fcx" class="headerlink" title="fcx"></a>fcx</h3><h4 id="u7F16_u8BD1_u6587_u4EF6"><a href="#u7F16_u8BD1_u6587_u4EF6" class="headerlink" title="编译文件"></a>编译文件</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fxc<span class="class">.exe</span> /Tvs_5_0 /Evs_main  demo/base/hlsl/inst_tex<span class="class">.vs</span><span class="class">.hlsl</span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





<nav id="pagination">
  
    <a href="/page/2/" class="alignleft prev">上一頁</a>
  
  
    <a href="/page/4/" class="alignright next">下一頁</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜尋">
    <input type="hidden" name="q" value="site:lenxyang.github.io">
  </form>
</div>

  

  
<div class="widget tag">
  <h3 class="title">標籤</h3>
  <ul class="entry">
  
    <li><a href="/tags/3d/">3d</a><small>1</small></li>
  
    <li><a href="/tags/android/">android</a><small>1</small></li>
  
    <li><a href="/tags/apache/">apache</a><small>1</small></li>
  
    <li><a href="/tags/azer3d/">azer3d</a><small>4</small></li>
  
    <li><a href="/tags/books/">books</a><small>1</small></li>
  
    <li><a href="/tags/chromium/">chromium</a><small>3</small></li>
  
    <li><a href="/tags/computer/">computer</a><small>1</small></li>
  
    <li><a href="/tags/computer-graphics/">computer graphics</a><small>7</small></li>
  
    <li><a href="/tags/direct3d/">direct3d</a><small>13</small></li>
  
    <li><a href="/tags/docker/">docker</a><small>2</small></li>
  
    <li><a href="/tags/effect/">effect</a><small>2</small></li>
  
    <li><a href="/tags/fuse/">fuse</a><small>1</small></li>
  
    <li><a href="/tags/gcc/">gcc</a><small>1</small></li>
  
    <li><a href="/tags/gdi/">gdi</a><small>1</small></li>
  
    <li><a href="/tags/gn/">gn</a><small>1</small></li>
  
    <li><a href="/tags/gnu/">gnu</a><small>1</small></li>
  
    <li><a href="/tags/grit/">grit</a><small>1</small></li>
  
    <li><a href="/tags/hdfs/">hdfs</a><small>2</small></li>
  
    <li><a href="/tags/hexo/">hexo</a><small>1</small></li>
  
    <li><a href="/tags/llvm/">llvm</a><small>1</small></li>
  
    <li><a href="/tags/opensource/">opensource</a><small>1</small></li>
  
    <li><a href="/tags/skia/">skia</a><small>1</small></li>
  
    <li><a href="/tags/ssl/">ssl</a><small>1</small></li>
  
    <li><a href="/tags/svn/">svn</a><small>3</small></li>
  
    <li><a href="/tags/toolchain/">toolchain</a><small>6</small></li>
  
    <li><a href="/tags/version-control/">version control</a><small>3</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2016 lenxyang@gmail.com
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>